<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=1000, initial-scale=1.0, maximum-scale=1.0">
    <!-- Bootstrap -->
    <link href="https://cdn.bootcss.com/flat-ui/2.3.0/css/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">	
    <!-- Flat UI -->
    <link href="https://cdn.bootcss.com/flat-ui/2.3.0/css/flat-ui.min.css" rel="stylesheet">
	<title>军训稿件提交系统</title>
</head>
<body>
	<div class="container">
		<h1>ZJUintl军训稿件提交系统</h1>
		<form>
			<div class="row"> 
			<div class="form-group col-xs-5">
            	姓名<input type="text" value="" placeholder="Inactive" class="form-control" id="Name" required/>
        	</div>
			<div class="form-group col-xs-5">
            	学号<input type="text" value="" placeholder="Inactive" class="form-control" id="Number" required/>
        	</div>


			</div>
			<div class="row">
				<div class="col-xs-3">
					稿件类型
					<br>
					<select class="form-control select select-primary" data-toggle="select" id="Type">
		            	<option value="诗词">诗词</option>
		            	<option value="通讯稿">通讯稿</option>

		          	</select>					
				</div>
				<div class="form-group col-xs-7">
	            	稿件标题<input type="text" value="" placeholder="Inactive" class="form-control" id="Title" required/>
	        	</div>						
			</div>
			<br>			
		</form>
		<div class="row">
			<div class="col-xs-5">
				<input type="file" class="btn btn-block btn-lg btn-warning" id="profilePhotoFileUpload">		
			</div>
			<div class="col-xs-5">
		 		<a class="btn btn-block btn-lg btn-inverse" id="Submit">提交</a>
			</div>
		</div>



	</div>

	<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdn.bootcss.com/flat-ui/2.3.0/js/flat-ui.min.js"></script>
	<script src="application.js"></script>
	<script type="text/javascript" src="bmob-min.js"></script>
	<script>
		Bmob.initialize("968ee2c53073efada1055d4f19a04e90", "7a72ab30cd2765ed44d33482b80fc70a");
		$(document).ready(function(){
			$("#Submit").click(function(){
				//Get Data
				var stuNumber = $("#Number").val();
				var artiType = $("#Type").val();
				var Title = $("#Title").val();
				//alert(Title);

				//Submit data
				var Student = Bmob.Object.extend("Student");
				//var myStudent = new Student();

				var query = new Bmob.Query(Student);
				query.equalTo("stuNumber",stuNumber);

	            query.find({
	                success: function(results) {
                        var objectfi = results[0];
                        //alert(objectfi.id);

                        //Set status to be true
                        var queryStatus = new Bmob.Query(Student);
					    queryStatus.get(objectfi.id, {
					      success: function(object) {
					        // The object was retrieved successfully.
					        object.set("Submit", true);
					        object.save(null, {
					          success: function(objectUpdate) {
					            //alert("create object success "+objectUpdate.get("Submit"));
					          },
					          error: function(model, error) {
					            alert("create object fail");
					          }
					        });
					      },
					      error: function(object, error) {
					        alert("query object fail");
					      }
					    });
	                },
	                error: function(error) {
	                    alert("Fail!");
	                }
	            });
				//Submit the file
    			var fileUploadControl = $("#profilePhotoFileUpload")[0];
		        if (fileUploadControl.files.length > 0) {
			        var bytes = fileUploadControl.files[0];
			        var name = artiType+" 一团十四连投稿 "+Title+".docx";
			        var file = new Bmob.File(name, bytes);
			        file.save().then(function(obj) {
					  //alert(obj.url());
					}, function(error) {
					  alert("Save failed.");
					});
		    	}
  			});
		});
	</script>
</body>
</html>